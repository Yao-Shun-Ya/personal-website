/* =========================================
   ğŸµ æ‚¬æµ®æ’­æ”¾å™¨æ ·å¼ (player.css - ç£å¸ç‰ˆ)
   ========================================= */

.music-player {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 280px;
    
    background: var(--header-bg, rgba(255, 255, 255, 0.85)); 
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    
    /* é»˜è®¤é˜´å½± */
    box-shadow: 0 5px 20px var(--shadow-color, rgba(0,0,0,0.2));
    
    z-index: 9999;
    font-family: 'ZCOOL KuaiLe', cursive; 
    color: var(--text-color, #333);
    
    overflow: visible; 

    /* âœ¨ å…³é”®æ”¹åŠ¨ï¼šTransform çš„è¿‡æ¸¡å¿…é¡»éå¸¸çŸ­ï¼Œè¿™æ ·ç£å¸æ‰è·Ÿæ‰‹ */
    /* Box-shadow å’Œ border ä¾ç„¶ä¿æŒæ…¢é€Ÿè¿‡æ¸¡ï¼Œåšå‘¼å¸æ„Ÿ */
    transition: transform 0.1s ease-out, 
                box-shadow 0.3s ease, 
                border-color 0.3s ease;
    
    /* æ€§èƒ½ä¼˜åŒ–ï¼šå‘Šè¯‰æµè§ˆå™¨è¿™è´§è¦åŠ¨ */
    will-change: transform, box-shadow;
}

/* æ³¨æ„ï¼šåˆ é™¤äº† .music-player:hover çš„æ ·å¼ï¼Œå…¨éƒ¨ç”± JS åŠ¨æ€æ§åˆ¶ */

/* 2. æ‹–æ‹½æ‰‹æŸ„ */
.player-handle {
    padding: 10px 15px;
    background: rgba(0,0,0,0.03);
    cursor: grab;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(0,0,0,0.05);
    user-select: none; 
    border-radius: 15px 15px 0 0;
}
.player-handle:active { cursor: grabbing; }

.player-title { color: var(--accent-pink, #FADADD); }

#toggle-playlist { 
    background: none; border: none; cursor: pointer; 
    font-size: 1.2rem; color: var(--text-color); 
    transition: color 0.3s;
}
#toggle-playlist:hover { color: var(--accent-pink); }

/* 3. å”±ç‰‡ä¸ä¿¡æ¯åŒº */
.player-body { padding: 15px; display: flex; align-items: center; gap: 15px; }

.cover-spin {
    width: 45px; height: 45px; border-radius: 50%;
    background: linear-gradient(45deg, var(--accent-pink), var(--accent-green));
    animation: spin 3s linear infinite;
    animation-play-state: paused;
    flex-shrink: 0;
}
.cover-spin.playing { animation-play-state: running; }
@keyframes spin { 100% { transform: rotate(360deg); } }

.song-info { flex: 1; overflow: hidden; }
#current-song-title {
    font-size: 0.9rem; margin-bottom: 5px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

.progress-container {
    height: 4px; background: rgba(0,0,0,0.1); 
    border-radius: 2px; cursor: pointer; margin-bottom: 3px;
    position: relative; 
}
.progress-container::after {
    content: ''; position: absolute; top: -5px; bottom: -5px; left: 0; right: 0;
}

.progress-bar {
    width: 0%; height: 100%; 
    background: var(--accent-green, #B4E4DA); border-radius: 2px;
}
.time-display { font-size: 0.7rem; opacity: 0.6; display: flex; justify-content: space-between; }

/* 4. åº•éƒ¨æ§åˆ¶åŒº */
.player-controls {
    display: flex; 
    align-items: center;
    justify-content: space-around; 
    padding: 10px;
    border-top: 1px solid rgba(0,0,0,0.05);
}
.player-controls button {
    background: none; border: none; cursor: pointer;
    font-size: 1.5rem; color: var(--text-color);
    transition: 0.2s;
}
.player-controls button:hover { color: var(--accent-pink); transform: scale(1.1); }

/* 5. æ’­æ”¾åˆ—è¡¨ (å‘ä¸Šå±•å¼€) */
.playlist {
    position: absolute;
    bottom: 100%;             
    left: 0;
    width: 100%;
    max-height: 0;            
    opacity: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 15px 15px 0 0;
    box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
    overflow-y: auto;
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    z-index: -1;              
    margin-bottom: -10px;     
    padding-bottom: 10px;     
    pointer-events: none;     
}
.playlist.show { 
    max-height: 200px;
    opacity: 1;
    margin-bottom: 0;
    padding-bottom: 0;
    pointer-events: auto; 
}
.playlist li {
    padding: 8px 15px; font-size: 0.85rem; cursor: pointer;
    border-bottom: 1px solid rgba(0,0,0,0.02);
    transition: background 0.2s;
}
.playlist li:hover { background: rgba(0,0,0,0.05); }
.playlist li.active { color: var(--accent-pink); font-weight: bold; }

[data-theme="dark"] .playlist {
    background: rgba(30, 30, 40, 0.95);
    border: 1px solid rgba(255,255,255,0.1);
}

/* 6. éŸ³é‡æ—‹é’® */
.volume-container {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    margin-left: 10px;
    cursor: ns-resize; 
}

.knob {
    width: 26px;
    height: 26px;
    background: radial-gradient(circle at 30% 30%, #eee, #ccc);
    border-radius: 50%;
    border: 1px solid #999;
    position: relative;
    transform: rotate(-135deg); 
    
    /* ç§»é™¤ transition ä¿è¯æ‹–åŠ¨ç»å¯¹è·Ÿæ‰‹ */
    transition: box-shadow 0.1s linear; 
}

.knob-indicator {
    position: absolute;
    top: 4px; left: 50%;
    transform: translateX(-50%);
    width: 3px; height: 3px;
    background-color: var(--accent-pink, #FADADD);
    border-radius: 50%;
    box-shadow: 0 0 2px rgba(0,0,0,0.5);
}

[data-theme="dark"] .knob {
    background: radial-gradient(circle at 30% 30%, #555, #222);
    border-color: #000;
}

/* ============================
   ğŸ“± 7. ç§»åŠ¨ç«¯æ·±åº¦é€‚é… (ç²¾è‡´å°æ–¹å—ç‰ˆ)
   ============================ */
@media screen and (max-width: 768px) {
    .music-player { 
        /* --- 1. å®¹å™¨å®šå‹ï¼šå°åœ†è§’æ–¹å— --- */
        width: 145px;          /* å›ºå®šå°å®½åº¦ */
        height: auto;          /* é«˜åº¦è‡ªé€‚åº” */
        
        /* ä½ç½®ï¼šå›ºå®šåœ¨å³ä¸‹è§’ï¼Œå•æ‰‹å¥½æŒ‰ */
        left: auto;
        right: 20px; 
        bottom: 90px;          /*ç¨å¾®é«˜ä¸€ç‚¹ï¼Œé¿å¼€æŸäº›æ‰‹æœºçš„åº•éƒ¨æ¨ªæ¡ */
        
        /* å¸ƒå±€ï¼šæ”¹ä¸ºç«–å‘æ’åˆ— (Column) */
        display: flex;
        flex-direction: column;
        
        border-radius: 24px;   /* å¤§åœ†è§’ï¼Œç±»ä¼¼ iOS å°ç»„ä»¶ */
        
        /* å¼ºåˆ¶é‡ç½®æ ·å¼ */
        transform: none !important; 
        box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        margin: 0;
    }

    /* --- 2. é¡¶éƒ¨æ‰‹æŸ„åŒº --- */
    .player-handle {
        padding: 8px 10px 0 10px; /* ä¸Šæ–¹ç•™ç™½ */
        justify-content: flex-end; /* åªæ˜¾ç¤ºåˆ—è¡¨æŒ‰é’®ï¼Œé å³ */
        background: transparent;
        border: none;
    }
    
    /* éšè—â€œèˆœã®æ’­æ”¾åˆ—è¡¨â€æ–‡å­—ï¼Œä¿æŒæ–¹å—ç®€æ´ */
    .player-title { display: none; }
    
    /* åˆ—è¡¨æŒ‰é’®ç¨å¾®å¤§ä¸€ç‚¹ï¼Œæ–¹ä¾¿ç‚¹ */
    #toggle-playlist { font-size: 1.2rem; }

    /* --- 3. æ ¸å¿ƒå†…å®¹åŒº (ç«–æ’) --- */
    .player-body { 
        flex-direction: column; /* ä¸Šä¸‹æ’åˆ— */
        padding: 5px 10px; 
        gap: 8px; 
        text-align: center;
    }

    /* å”±ç‰‡å˜å¤§ä¸€ç‚¹ï¼Œä½œä¸ºè§†è§‰ä¸­å¿ƒ */
    .cover-spin {
        width: 55px; 
        height: 55px; 
        margin: 0 auto; /* å±…ä¸­ */
        border: 3px solid rgba(255,255,255,0.3); /* åŠ ä¸ªå…‰åœˆæ›´æœ‰è´¨æ„Ÿ */
    }

    .song-info { 
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    #current-song-title {
        font-size: 0.8rem;
        margin-bottom: 2px;
        max-width: 120px; /* é™åˆ¶å®½åº¦é˜²æ­¢æ’‘å¼€ */
        text-align: center;
    }

    /* éšè—æ‰‹æœºç«¯ç´¯èµ˜çš„è¿›åº¦æ¡å’Œæ—¶é—´ï¼Œè¿½æ±‚æè‡´ç´§å‡‘ */
    .progress-container, .time-display { display: none; }

    /* --- 4. åº•éƒ¨æ§åˆ¶åŒº --- */
    .player-controls {
        padding: 5px 0 15px 0; /* ä¸‹æ–¹å¤šç•™ç‚¹ç™½ */
        border: none;
        width: 100%;
        justify-content: center; /* æŒ‰é’®å±…ä¸­ */
        gap: 15px; /* æŒ‰é’®é—´è· */
    }
    
    .player-controls button {
        font-size: 1.3rem; 
    }

    /* æ‰‹æœºç«¯éšè—éŸ³é‡æ—‹é’® (ç›´æ¥æŒ‰æ‰‹æœºéŸ³é‡é”®æ›´å¥½ï¼Œçœç©ºé—´) */
    .volume-container { display: none; }

    /* --- 5. åˆ—è¡¨å¼¹å‡ºçš„é€‚é… --- */
    /* åˆ—è¡¨ä»æ–¹å—ä¸Šæ–¹å¼¹å‡ºæ¥ */
    .playlist {
        width: 200px; /* åˆ—è¡¨æ¯”æ’­æ”¾å™¨å®½ä¸€ç‚¹ï¼Œä½“éªŒæ›´å¥½ */
        right: 0;     /* é å³å¯¹é½ */
        left: auto;   /* å–æ¶ˆé å·¦ */
        border-radius: 15px;
        bottom: 110%; /* ç¨å¾®ç¦»è¿œä¸€ç‚¹ */
    }
    .playlist.show { max-height: 250px; }
}